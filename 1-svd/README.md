# SVD矩阵分解与降维

实现了基于奇异值分解（SVD）的稀疏矩阵降维分析，模拟推荐系统中的用户-商家评分矩阵处理。

## 📁 项目结构

```
1-svd/
├── main.py                    # 主程序入口
├── config.py                  # 配置管理
├── matrix_generator.py        # 稀疏矩阵生成
├── svd_operations.py         # SVD分解与降维
├── similarity_analyzer.py    # 相似度分析
├── requirements.txt          # 依赖包
└── work_old.py              # 原始单文件版本（备份）
```

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行程序

```bash
python3 main.py
```

## 📋 作业要求

### 1. 稀疏矩阵构造
随机构造一个 100×1000 的用户-商家稀疏矩阵 A，确保矩阵满足稀疏性特征。

### 2. SVD分解与降维

**任务(a)**:
- 利用SVD对矩阵A进行分解，求解U和V矩阵
- 在 r=10 的条件下计算降维矩阵

**任务(b)**:
- 从矩阵A中选择两行 i 和 j，使得 A_i 和 A_j 中非零元素的交集为空
- 计算 i 和 j 在低维空间的相似度

## 🏗️ 代码架构

### 模块说明

#### `config.py` - 配置管理
使用 `dataclass` 管理所有可配置参数：
- 矩阵维度（用户数、商品数）
- 稀疏度设置
- 降维参数（保留的奇异值数量）
- 随机种子（确保可复现性）

#### `matrix_generator.py` - 矩阵生成
`SparseMatrixGenerator` 类提供：
- `generate_matrix()`: 生成稀疏评分矩阵
- `get_matrix_info()`: 获取矩阵统计信息
- `print_matrix_info()`: 格式化输出矩阵信息

#### `svd_operations.py` - SVD操作
`SVDProcessor` 类提供：
- `decompose()`: 执行SVD分解和降维
- `compute_reconstruction_error()`: 计算重构误差
- `compute_energy_retention()`: 计算能量保留率
- `print_svd_info()`: 格式化输出SVD结果

#### `similarity_analyzer.py` - 相似度分析
`SimilarityAnalyzer` 类提供：
- `find_non_intersecting_rows()`: 寻找无交集的行
- `compute_cosine_similarity()`: 计算余弦相似度
- `compute_euclidean_distance()`: 计算欧氏距离
- `analyze_row_similarity()`: 综合相似度分析

#### `main.py` - 主程序
清晰的执行流程：
1. 初始化配置
2. 生成稀疏矩阵
3. 执行SVD分解与降维
4. 进行相似度分析

## 🔧 参数配置

可以在 `config.py` 中修改以下参数：

```python
@dataclass
class SVDConfig:
    # 矩阵维度
    n_users: int = 100          # 用户数
    n_items: int = 1000         # 商品数

    # 稀疏度
    density: float = 0.05       # 5%的元素非零

    # 评分范围
    min_rating: int = 1         # 最低评分
    max_rating: int = 6         # 最高评分+1（实际范围1-5）

    # 降维参数
    n_components: int = 10      # 保留的奇异值数量 (r)

    # 随机种子
    random_seed: int = 42       # 确保结果可复现
```

## 📊 输出示例

```
============================================================
作业：SVD矩阵分解与降维
============================================================

------------------------------------------------------------
【步骤1】构造稀疏矩阵
------------------------------------------------------------
矩阵形状: (100, 1000)
非零元素数量: 5000
稀疏度: 95.00%
密度: 5.00%

------------------------------------------------------------
【步骤2(a)】SVD分解与降维
------------------------------------------------------------
U矩阵形状: (100, 100)
奇异值向量形状: (100,)
V^T矩阵形状: (100, 1000)

前20个奇异值: [...]

降维后的矩阵维度:
U_r: (100, 10)
Sigma_r: (10, 10)
Vt_r: (10, 1000)
A_reduced: (100, 1000)

重构误差 (Frobenius范数): 211.4212
相对误差: 89.77%
前10个奇异值保留的能量比例: 19.42%

------------------------------------------------------------
【步骤2(b)】选择两行并计算低维相似度
------------------------------------------------------------
找到的两行: 行0 和 行2
行0的非零元素位置数量: 45
行2的非零元素位置数量: 56
交集大小: 0 (无交集)

相似度计算结果:
余弦相似度: -0.038272
欧氏距离: 0.358539
点积: -0.002245

============================================================
作业完成！
============================================================
```

## 🎯 优化亮点

### 1. 模块化设计
- **单一职责原则**: 每个模块负责单一功能
- **高内聚低耦合**: 模块间依赖关系清晰
- **易于测试**: 可以单独测试每个模块

### 2. 面向对象
- 使用类封装相关功能
- 提供清晰的API接口
- 便于扩展和复用

### 3. 类型提示
- 使用Python类型注解（Type Hints）
- 提高代码可读性和IDE支持
- 减少运行时错误

### 4. 配置管理
- 集中管理所有参数
- 使用 `dataclass` 简化配置
- 易于调整和实验

### 5. 文档完善
- 每个函数都有详细的docstring
- 参数和返回值说明清晰
- 便于理解和维护

## 🧮 算法原理

### SVD分解
```
A ≈ U @ Σ @ V^T
```

其中：
- **U**: 用户的潜在特征矩阵 (100×10)
- **Σ**: 奇异值对角矩阵 (10×10)
- **V^T**: 商品的潜在特征矩阵 (10×1000)

### 降维优势
1. **数据压缩**: 从100维降到10维
2. **去噪**: 去除不重要的特征
3. **发现潜在模式**: 即使原始空间无交集，也能在低维空间发现相似性

### 相似度意义
即使两个用户没有评价过相同的商品（原始空间无交集），通过SVD降维后，仍可能在低维空间中发现相似性。这是因为SVD捕捉了**潜在的偏好模式**。

## 📚 扩展功能建议

1. **可视化**: 添加矩阵热图、奇异值分布图
2. **性能分析**: 比较不同r值的效果
3. **实际应用**: 基于相似度进行推荐
4. **并行计算**: 优化大规模矩阵处理
5. **增量更新**: 支持动态添加新用户/商品

## 🔄 版本历史

- **v2.0** (当前版本): 模块化重构，面向对象设计
- **v1.0** (`work_old.py`): 单文件实现版本

## 📝 注意事项

- 确保Python版本 >= 3.7（需要dataclass支持）
- 稀疏矩阵生成具有随机性，使用相同的random_seed可保证结果一致
- 对于大规模矩阵，可能需要调整内存使用策略
